code provided by Duncan Lorimer.
